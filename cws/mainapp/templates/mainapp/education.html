{%extends 'mainapp/base.html'%}

{%block content%}
    <main class="main-content">
        <div class="container">
            <div class="mx-auto mx-width-1100">
              <header>
                <h1>{{title}}</h1>
                </header>
                <nav id='pagination'>
                    <ul class='pagination'>
                        {% for i in  object_list.paginator.page_range %}
                                {% if object_list.number == i %}
                                    <li class="page-item active"><a class="page-link" href="{{request.path}}?page={{i}}">{{ i }}</a></li>
                                {% else %}
                                    <li class="page-item"><a class="page-link" href="{{request.path}}?page={{i}}">{{ i }}</a></li>
                                {% endif %}
                        {% endfor%}         
                    </ul>
                    </nav>
                    {% for i in  object_list%}
                    <div id="mycontent" class="card mb-3 bg-light">
                            <div class="card-text mx-auto">
                                {% autoescape off %}{{ i.text }}{% endautoescape %}
                                
                            </div>
                            {%if object_list.has_next %}
                                <a class="btn btn-primary" id="next-btn" href="{{ request.path}}?page={{object_list.next_page_number}}" role="button">Next</a>
                            {%else %}
                                <a class="btn btn-primary" href="/" role="button">На главную</a>
                            {% endif%}
                    </div>
                    {% endfor%} 
                
                
            </div>
            
                
            
        </div>
    </main>
    
    <script>
        function ajaxPagination() {
            $('#pagination a.page-link, #next-btn').each((index, el)  => {
                $(el).click((e) => {
                    e.preventDefault()
                    let pageUrl = $(el).attr('href')
                    $.ajax({
                        url: pageUrl, 
                        type: 'GET',
                        success: (data) => {
                            $('#pagination').empty()
                            $('#pagination').append($(data).find('#pagination').html())
                            $('#mycontent').empty()
                            $('#mycontent').append($(data).find('#mycontent').html())
                        }    

                    })
                })
            })
        }

            $(document).ready(function() {
                ajaxPagination()
            })

            $(document).ajaxStop(function() {
                ajaxPagination()
            })
            
    </script>
{%endblock%}




